## 常见功能场景

### 指定容器运行主机

对容器的调度策略进行配置。可以将容器固定在某个主机上，这样方便数据的保存。

操作路径：【应用】--【控制台右侧-三角符号】--【配置】--【调度与发布】--【调度策略】

> 任意主机：让DCE集群对Pod进行自动调度
> 指定标签下的任意主机：让Pod调度到指定的DCE集群一组相同标签的主机上
> 指定的主机：让Pod调度到指定的DCE集群计算节
> 其他：可以定义Pod容器组的亲和性和反亲和性策略

将容器组调度到指定的主机
> ![image-17](../images/image-17.png)

### 容器目录映射到主机

在文件系统映射中，可以对容器和宿主机的目录映射进行管理。可以将数据库容器中的数据保存到主机上，这样容器重启后数据不会丢失。

操作路径：【应用】--【控制台右侧-三角符号】--【配置】--【存储资源】-【文件系统映射】--【添加文件系统映射】

> 需要注意的是，这是针对目录映射。文件映射采用的是配置文件方法。见下一小节--「配置管理」。

> ![image-18](../images/image-18.png)

### 容器文件映射

在配置管理中，可以为容器挂载配置文件（ConfigMap）。

> 需要注意的是，挂载配置文件默认认为容器中该级目录中只有这一个文件，如果该级目录中有多个文件，且只想挂载其中的一个文件，需要在编排文件中增加subPath字段。

* 首先定义配置文件。

操作路径：【配置管理】--【配置文件】--【创建配置文件】

> ![image-19](../images/image-19.png)

* 其次为应用挂载配置文件

操作路径：【应用】--【控制台右侧-三角符号】--【配置】--【容器配置】--【配置管理】--【添加配置文件】

> ![image-20](../images/image-20.png)

* 如果只要挂载目录中的一个文件

操作路径：【应用】--【点击<应用名>】--【编排】--【展开YAML编排】

> ![image-21](../images/image-21.png)

* 如果需要修改配置文件

操作路径：【配置管理】--【配置文件】--【点击<配置文件名>】--【编辑内容】

> ![image-22](../images/image-22.png)

### 配置域名访问

为应用添加公网访问域名

操作路径：【应用】--【点击<应用名>】--【负载均衡】--【添加7层负载均衡】

> 域名：比如xxx.dev.cosmoplat.com
> 路径：首页的路径。比如/
> 4层负载均衡：下拉选择需要暴露的4层负载均衡
> 4层负载均衡端口：下拉选择需要暴露的端口

> ![image-23](../images/image-23.png)

### 调整容器的时区

一般情况容器内是UTC时区，如果需要设置为北京时间，参见 「文件系统映射 」小节，将主机的/etc/localtime和容器的/etc/localtime做映射。

> ![image-24](../images/image-24.png)

### 应用组件调用

通过service名称(或ip)和端口来访问。

以tomcat访问mysql为例,在tomcat定义数据库连接配置文件中的mysql主机需要填写为haier-mysql,端口为3306。

主机的协议不能丢,如:

> amqp://guest:guest@haier-activemq:5672
> redis://haier-redis:6379
> postgresql://postgres:root@haier-postgresql:5432
> mysql://root:mypass@haier-mysql:3306

或

> amqp://guest:guest@10.96.244.53:5672
> redis://10.109.148.132:6379
> postgresql://postgres:root@10.96.244.55:5432
> mysql://root:mypass@10.103.99.140:3306

> ![image-25](../images/image-25.png)

### 容器计算资源设置

对容器使用的CPU和内存资源进行修改，以符合整体资源的限制要求。

操作路径：【应用】--【控制台右侧-三角符号】--【配置】--【计算资源】

> 限制（limits）：限制每个容器使用的资源最大值
> 预留（requests）：主要用于调度器在Pod调度计算时使用

> ![image-26](../images/image-26.png)

### 登录到容器内操作

登录到容器内可以查看文件，方便定位问题。

操作路径：【应用】--【控制台】

> ![image-27](../images/image-27.png)

### 向容器上传文件

可以向容器上传文件，方便调试程序。

操作路径：【应用】--【控制台右侧-三角符号】--【其它操作】--【上传文件】

> 同样，也可以从容器下载文件

> ![image-28](../images/image-28.png)

### 通过应用模版部署

一些中间件可以通过应用模版部署。更建议的是，在互联网模版的基础上进行定制，以此满足如时区修改、文件映射等。

操作路径：【应用模版】--【创建应用模版】

> ![image-29](../images/image-29.png)

